<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Blocs 1.9.4</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="icon" href="../img/1.ico" type="image/x-icon">
</head>
<body>
    <nav class="navbar">
        <div><img class="logo" src="img/1.png"></div>
        <div class="links">
            <a href="../index.html">Accueil</a>
            <a href="../base/base.html">Blocs de base</a>
            <a href="../veg/veg.html">Blocs de bois et feuilles</a>
            <a href="../min/min.html">Blocs de minerais</a>
            <a href="../const/const.html">Blocs de construction</a>
            <a href="../dec/dec.html">Blocs décoratifs</a>
            <a href="../mec/mec.html">Blocs mécaniques</a>
            <a href="../nat/nat.html">Blocs naturels</a>
            <a href="../red/red.html">Blocs de redstone</a>
            <a href="../deco/deco.html">Blocs de décoration</a>
            <a href="../div/div.html">Blocs divers</a>
            <a href="../com/com.html">Commentaire</a>
        </div>
    </nav>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .comment-section {
            width: 100%;
            max-width: 600px;
            margin: auto;
        }
        .comment-section h2 {
            text-align: center;
        }
        .comment-form {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }
        .comment-form textarea {
            resize: none;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            height: 100px;
        }
        .comment-form button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .comment-form button:hover {
            background-color: #45a049;
        }
        .comment-list {
            margin-top: 20px;
        }
        .comment {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .comment .author {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .comment .text {
            font-size: 16px;
        }
        .comment button {
            background-color: #FF0000;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
        }
        .comment button:hover {
            background-color: #cc0000;
        }
        .password-form {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }
        .password-form input {
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <div class="comment-section">
        <h2>Écrire un Commentaire</h2>

        <!-- Formulaire de commentaire -->
        <div class="comment-form">
            <textarea id="comment-text" placeholder="Écrivez votre commentaire ici..."></textarea>
            <button onclick="submitComment()">Soumettre le Commentaire</button>
        </div>

        <!-- Liste des commentaires -->
        <div class="comment-list" id="comment-list"></div>
    </div>

    <div class="password-form">
        <input type="password" id="admin-password" placeholder="Entrez le mot de passe pour supprimer">
        <button onclick="validatePassword()">Valider</button>
    </div>

    <script>
        const apiUrl = 'http://votre_serveur_distant:3000'; // Remplacez par l'URL de votre serveur Node.js

        // Charger les commentaires lors du chargement de la page
        window.onload = function() {
            loadComments();
        };

        // Fonction pour charger les commentaires depuis l'API
        function loadComments() {
            fetch(apiUrl + '/comments')
                .then(response => response.json())
                .then(comments => {
                    const commentsContainer = document.getElementById('comments-container');
                    commentsContainer.innerHTML = ''; // Réinitialiser l'affichage
                    comments.forEach(comment => {
                        displayComment(comment);
                    });
                })
                .catch(error => console.error('Erreur de chargement des commentaires:', error));
        }

        // Fonction pour afficher un commentaire dans la liste
        function displayComment(comment) {
            const commentDiv = document.createElement('div');
            commentDiv.classList.add('comment');
            commentDiv.innerHTML = `
                <div><strong>${comment.author}</strong>: ${comment.text}</div>
                <button onclick="deleteComment(${comment.id})">Supprimer</button>
            `;
            document.getElementById('comments-container').appendChild(commentDiv);
        }

        // Fonction pour soumettre un commentaire via l'API
        function submitComment() {
            const author = document.getElementById('author').value;
            const commentText = document.getElementById('comment-text').value;

            if (author && commentText) {
                const newComment = { author, text: commentText };

                fetch(apiUrl + '/comments', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(newComment),
                })
                .then(response => {
                    if (response.ok) {
                        loadComments(); // Recharger les commentaires après ajout
                        document.getElementById('author').value = '';
                        document.getElementById('comment-text').value = '';
                    } else {
                        alert('Erreur lors de l\'ajout du commentaire.');
                    }
                })
                .catch(error => console.error('Erreur lors de l\'ajout du commentaire:', error));
            } else {
                alert('Veuillez remplir le champ auteur et le commentaire.');
            }
        }

        // Fonction pour supprimer un commentaire via l'API
        function deleteComment(commentId) {
            const password = document.getElementById('admin-password').value;
            if (password) {
                fetch(apiUrl + '/validate-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                })
                .then(response => {
                    if (response.ok) {
                        fetch(apiUrl + '/comments/' + commentId, {
                            method: 'DELETE',
                        })
                        .then(response => {
                            if (response.ok) {
                                loadComments(); // Recharger les commentaires après suppression
                            } else {
                                alert('Erreur lors de la suppression du commentaire.');
                            }
                        })
                        .catch(error => console.error('Erreur lors de la suppression:', error));
                    } else {
                        alert('Mot de passe incorrect.');
                    }
                })
                .catch(error => console.error('Erreur de validation du mot de passe:', error));
            } else {
                alert('Veuillez entrer le mot de passe pour supprimer.');
            }
        }

        // Fonction pour valider le mot de passe (pour suppression)
        function validatePassword() {
            const password = document.getElementById('admin-password').value;
            if (password) {
                fetch(apiUrl + '/validate-password', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                })
                .then(response => {
                    if (response.ok) {
                        alert('Mot de passe correct, vous pouvez supprimer des commentaires.');
                    } else {
                        alert('Mot de passe incorrect.');
                    }
                })
                .catch(error => console.error('Erreur de validation du mot de passe:', error));
            } else {
                alert('Veuillez entrer un mot de passe.');
            }
        }
    </script>

</body>
</html>
